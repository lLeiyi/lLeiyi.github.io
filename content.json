{"meta":{"title":"lLeiyi的博客","subtitle":null,"description":null,"author":"lLeiyi","url":"http://yoursite.com"},"pages":[{"title":"标签","date":"2018-07-16T16:31:45.000Z","updated":"2018-07-16T16:32:05.154Z","comments":true,"path":"tags/index.html","permalink":"http://yoursite.com/tags/index.html","excerpt":"","text":""},{"title":"分类","date":"2018-07-15T16:38:36.000Z","updated":"2018-07-16T16:20:54.283Z","comments":true,"path":"categories/index.html","permalink":"http://yoursite.com/categories/index.html","excerpt":"","text":""}],"posts":[{"title":"导入导出数据常用的方法","slug":"导入导出数据常用的方法","date":"2018-11-20T08:44:32.296Z","updated":"2019-03-05T11:45:23.660Z","comments":true,"path":"2018/11/20/导入导出数据常用的方法/","link":"","permalink":"http://yoursite.com/2018/11/20/导入导出数据常用的方法/","excerpt":"","text":"数据的导入导出是很常见的操作，我之前会采用以下 2 种方法来实现： 调用 Insert 和 CreateFeatureBuffer 的方式，从源数据读数据后一条条赋属性赋图形的插入，这种方式的一般不会出现什么问题，但是赋属性步骤繁琐，还要注意字段类型，而且执行效率一般。 调用 gp 工具，这种方式调用简便，参数简单，速度也蛮快，但是我在项目中用时常出现不知名错误（不是路径问题，相同的参数相同的代码另起一个测试项目就能跑通）。 那还有没有其它实现方法呢，我在网上搜索了好久发现了 Arcgis 还提供了这样的接口，就在此记录下来。（以下代码是复制来的，具体出处忘记了。。。）12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273 /// &lt;summary&gt; /// 要素类的转移 /// &lt;/summary&gt; /// &lt;param name=&quot;sourceWorkspace&quot;&gt;源数据工作空间（shp）&lt;/param&gt; /// &lt;param name=&quot;targetWorkspace&quot;&gt;目标数据工作空间（mdb）&lt;/param&gt; /// &lt;param name=&quot;nameOfSourceFeatureClass&quot;&gt;源要素类名&lt;/param&gt; /// &lt;param name=&quot;nameOfTargetFeatureClass&quot;&gt;目标要素类名&lt;/param&gt; /// &lt;param name=&quot;queryFilter&quot;&gt;&lt;/param&gt; /// &lt;returns&gt;&lt;/returns&gt; private bool IFeatureDataConverter_ConvertFeatureClass(IWorkspace sourceWorkspace, IWorkspace targetWorkspace,string nameOfSourceFeatureClass, string nameOfTargetFeatureClass, IQueryFilter queryFilter) &#123; //创建一个源数据的工作空间的name IDataset sourceWorkspaceDataset = (IDataset)sourceWorkspace; IWorkspaceName sourceWorkspaceName = (IWorkspaceName)sourceWorkspaceDataset.FullName; //创建源数据Name作为转换参数 IFeatureClassName sourceFeatureClassName = new FeatureClassNameClass(); IDatasetName sourceDatasetName = (IDatasetName)sourceFeatureClassName; sourceDatasetName.WorkspaceName = sourceWorkspaceName; //这个参数不能乱填（shp文件就是文件名没后缀，FeatureClass或者FeatureDataset就是AliasName） sourceDatasetName.Name = nameOfSourceFeatureClass; //创建目标（导出）数据空间的name IDataset targetWorkspaceDataset = (IDataset)targetWorkspace; IWorkspaceName targetWorkspaceName = (IWorkspaceName)targetWorkspaceDataset.FullName; //创建目标数据Name作为转换参数 IFeatureClassName targetFeatureClassName = new FeatureClassNameClass(); IDatasetName targetDatasetName = (IDatasetName)targetFeatureClassName; targetDatasetName.WorkspaceName = targetWorkspaceName; //这个命名也很重要，如果是mdb，那么这个命名在数据库中必须是本来不存在的（当然你可以先清空数据库） targetDatasetName.Name = nameOfTargetFeatureClass; //根据FetureClassName打开数据 ESRI.ArcGIS.esriSystem.IName sourceName = (ESRI.ArcGIS.esriSystem.IName)sourceFeatureClassName; IFeatureClass sourceFeatureClass = (IFeatureClass)sourceName.Open(); //在两个不同的工作空间转换数据要检查字段的有效性 //一些检查有效性的参数 IFieldChecker fieldChecker = new FieldCheckerClass(); IFields targetFeatureClassFields; IFields sourceFeatureClassFields = sourceFeatureClass.Fields; IEnumFieldError enumFieldError; //设置检查有效性的源数据工作空间 fieldChecker.InputWorkspace = sourceWorkspace; fieldChecker.ValidateWorkspace = targetWorkspace; //（这个函数没有返回值我不知道它如何确定有效性滴） fieldChecker.Validate(sourceFeatureClassFields, out enumFieldError, out targetFeatureClassFields); //通过输出字段循环找出几何字段 IField geometryField; //遍历字段 for (int i = 0; i &lt; targetFeatureClassFields.FieldCount; i++) &#123; //找到定义几何要素类型的字段 if (targetFeatureClassFields.get_Field(i).Type == esriFieldType.esriFieldTypeGeometry) &#123; //获取当前字段 geometryField = targetFeatureClassFields.get_Field(i); //编辑几何要素类型字段 IGeometryDef geometryDef = geometryField.GeometryDef; IGeometryDefEdit targetFCGeoDefEdit = (IGeometryDefEdit)geometryDef; //说实话，下面两行我实在不知道用处。。。参数也是看文档抄袭的 targetFCGeoDefEdit.GridCount_2 = 1; targetFCGeoDefEdit.set_GridSize(0, 0); //保证空间参考 SpatialReference_2属性字段才是可写的，SpatialReference属性只可读 targetFCGeoDefEdit.SpatialReference_2 = geometryField.GeometryDef.SpatialReference; //开始转换 IFeatureDataConverter myConvert = new FeatureDataConverterClass(); myConvert.ConvertFeatureClass(sourceFeatureClassName, queryFilter, null, targetFeatureClassName, geometryDef, targetFeatureClassFields, &quot;&quot;, 1000, 0); return true; &#125; &#125; return false; &#125;","categories":[{"name":"ArcEngine","slug":"ArcEngine","permalink":"http://yoursite.com/categories/ArcEngine/"},{"name":"实用函数","slug":"ArcEngine/实用函数","permalink":"http://yoursite.com/categories/ArcEngine/实用函数/"}],"tags":[{"name":"ArcEngine","slug":"ArcEngine","permalink":"http://yoursite.com/tags/ArcEngine/"}]},{"title":"ArcEngine中featurecursor分别在sde数据库和gdb数据库下的遍历问题","slug":"featurecursor分别在sde数据库和gdb数据库下的遍历问题","date":"2018-11-20T03:18:42.163Z","updated":"2019-03-05T11:46:53.529Z","comments":true,"path":"2018/11/20/featurecursor分别在sde数据库和gdb数据库下的遍历问题/","link":"","permalink":"http://yoursite.com/2018/11/20/featurecursor分别在sde数据库和gdb数据库下的遍历问题/","excerpt":"","text":"问题描述123456//一般的循环遍历步骤IFeatureCursor featureCursor = featureClass.Search(null,false);IFeature feature = null;while((feature = featureCursor.NextFeature())!=null)&#123;&#125; 以上是常用的循环遍历的步骤，最后遍历到 feature 为 null 后退出 while 循环，这时如果再执行一次 featureCursor.NextFeature() 语句： 1.在 gdb 和 mdb 数据库下会得到 null； 2.在 sde 数据库下会得到“调用的函数顺序有误 [Function called out of sequence]”的报错。","categories":[{"name":"ArcEngine","slug":"ArcEngine","permalink":"http://yoursite.com/categories/ArcEngine/"},{"name":"记录&&踩过的坑","slug":"ArcEngine/记录-踩过的坑","permalink":"http://yoursite.com/categories/ArcEngine/记录-踩过的坑/"}],"tags":[{"name":"ArcEngine","slug":"ArcEngine","permalink":"http://yoursite.com/tags/ArcEngine/"},{"name":"IFeaturecursor","slug":"IFeaturecursor","permalink":"http://yoursite.com/tags/IFeaturecursor/"}]},{"title":"ArcEngine中打开各种数据源（WorkSpace）的连接","slug":"IWorkspace的创建问题","date":"2018-11-19T09:23:53.307Z","updated":"2019-03-05T11:45:33.260Z","comments":true,"path":"2018/11/19/IWorkspace的创建问题/","link":"","permalink":"http://yoursite.com/2018/11/19/IWorkspace的创建问题/","excerpt":"","text":"1. 创建workspacefactory1234567891011//方式1Type factoryGDBType = Type.GetTypeFromProgID(&quot;esriDataSourcesGDB.FileGDBWorkspaceFactory&quot;);Type factorySDEType = Type.GetTypeFromProgID(&quot;esriDataSourcesGDB.SdeWorkspaceFactory&quot;);Type factoryMDBType = Type.GetTypeFromProgID(&quot;esriDataSourcesGDB.AccessWorkspaceFactory&quot;);IWorkspaceFactory workspaceFactory = (IWorkspaceFactory)Activator.CreateInstance(factory***Type);------------------------------------------------------------------------------------------------------//方式2IWorkspaceFactory wksGDBFactory = new FileGDBWorkspaceFactoryClass();IWorkspaceFactory wksSDEFactory = new SdeWorkspaceFactoryClass();IWorkspaceFactory wksMDBFactory = new AccessWorkspaceFactoryClass(); 2. 调用workspacefactory的方法打开数据源123456789101112//MDB,GDB,SDE文件路径string strDbPath = &quot;文件路径&quot;;IWorkspace wks = wksFactory.OpenFromFile(strDbPath, 0);//SDE也可通过连接信息打开IPropertySet propSet=new PropertySetClass();propSet.SetProperty(&quot;server&quot;,&quot;服务器机器名&quot; );propSet.SetProperty(&quot;instance&quot;,&quot;SDE运行的端口号&quot;);propSet.SetProperty(&quot;user&quot;,&quot;用户名&quot;);propSet.SetProperty(&quot;password&quot;,&quot;口令&quot; );propSet.SetProperty(&quot;password&quot;,&quot;口令&quot; );IWorkspace wks = wksFactory.Open(propSet, 0); PS：获取 MDB，GDB 文件路径时要注意，“右键数据库文件=》属性=》安全=》对象名称”，此处的文件路径有问题，如要选路径可从资源管理器的文件路径复制。","categories":[{"name":"ArcEngine","slug":"ArcEngine","permalink":"http://yoursite.com/categories/ArcEngine/"},{"name":"记录&&踩过的坑","slug":"ArcEngine/记录-踩过的坑","permalink":"http://yoursite.com/categories/ArcEngine/记录-踩过的坑/"}],"tags":[{"name":"ArcEngine","slug":"ArcEngine","permalink":"http://yoursite.com/tags/ArcEngine/"},{"name":"IWorkspace","slug":"IWorkspace","permalink":"http://yoursite.com/tags/IWorkspace/"}]},{"title":"ArcEngine中IMap的选择集刷新问题","slug":"IMap的选择集刷新问题","date":"2018-07-16T15:33:46.140Z","updated":"2019-03-05T11:45:55.742Z","comments":true,"path":"2018/07/16/IMap的选择集刷新问题/","link":"","permalink":"http://yoursite.com/2018/07/16/IMap的选择集刷新问题/","excerpt":"","text":"1.问题描述通过以下方式可以很便捷的往选择集内添加要素，但是却无法触发 AxMapControl 下的 OnSelectionChanged 事件。 12345678910111213public static void SelectFeatures(IFeatureLayer featureLayer, int[] OIDs)&#123; if (pFeatureLayer == null || OIDs == null) &#123; return; &#125; IFeatureSelection featureSelection = featureLayer as IFeatureSelection; if (featureSelection != null) &#123; IGeoDatabaseBridge2 geoDatabaseBridge2 = new GeoDatabaseHelperClass(); geoDatabaseBridge2.AddList(featureSelection.SelectionSet, ref OIDs); &#125;&#125; 2.通过ISelectEvents接口解决可以通过 ISelectEvents 接口来解决这个问题,该接口可由 IMap 接口 QI。 12345ISelectionEvents selectEvents = map as ISelectionEvents;if (selectEvents != null)&#123; selectEvents.SelectionChanged();&#125;","categories":[{"name":"ArcEngine","slug":"ArcEngine","permalink":"http://yoursite.com/categories/ArcEngine/"},{"name":"记录&&踩过的坑","slug":"ArcEngine/记录-踩过的坑","permalink":"http://yoursite.com/categories/ArcEngine/记录-踩过的坑/"}],"tags":[{"name":"ArcEngine","slug":"ArcEngine","permalink":"http://yoursite.com/tags/ArcEngine/"},{"name":"ISelectEvents","slug":"ISelectEvents","permalink":"http://yoursite.com/tags/ISelectEvents/"}]}]}